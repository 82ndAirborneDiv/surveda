{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Ask JSON Schemas",

  "definitions": {
    "questionnaire": {
      "type": "object",
      "properties": {
        "steps": { "$ref": "#/definitions/steps" },
        "quota_completed_msg": { "oneOf": [{ "$ref": "#/definitions/prompt" }, {"type":"null"}] },
        "error_msg": { "oneOf": [{ "$ref": "#/definitions/prompt" }, {"type":"null"}] }
      },
      "required": ["steps"]
    },

    "steps": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/step"
      }
    },

    "step": {
      "properties": {
        "id": {"type": "string"},
        "type": { "enum": ["multiple-choice", "numeric", "language-selection", "explanation"] },
        "title": {"type": "string"},
        "prompt": { "anyOf": [{"$ref": "#/definitions/prompt"}, {"$ref": "#/definitions/lang_prompt"}]},
        "store": { "type": "string" },
        "choices": { "$ref": "#/definitions/choices" },
        "language_choices": { "type": "array" },
        "min_value": {"type": ["integer", "null"]},
        "max_value": {"type": ["integer", "null"]},
        "ranges_delimiters": {"type": ["string", "null"]},
        "ranges": {"$ref": "#/definitions/ranges"},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false,
      "required": ["id", "type", "title", "prompt"]
    },
    "choices": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/choice"
      }
    },

    "choice": {
      "properties": {
        "value": {"type": "string"},
        "responses": {"$ref": "#/definitions/responses"},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false,
      "required": ["responses", "value", "skip_logic"]
    },

    "ranges": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/range"
      }
    },
    "range": {
      "properties": {
        "from": {"type": ["integer", "null"]},
        "to": {"type": ["integer", "null"]},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false
    },

    "responses": {
      "type": "object",
      "properties": {
        "sms": {
          "type": "object",
          "additionalProperties": {
            "type": "array"
          }
        },
        "ivr": {
          "type": "array"
        }
      }
    },

    "prompt": {
      "type": "object",
      "additionalProperties": {"$ref": "#/definitions/lang_prompt"}
    },

    "lang_prompt": {
      "type": "object",
      "properties": {
        "sms": {"type": "string" },
        "ivr": {"$ref": "#/definitions/ivr"}
      },
      "additionalProperties": false
    },

    "ivr": {
      "type": "object",
      "properties": {
        "text": {"type": "string"},
        "audio_source": {"enum": ["tts", "upload"]},
        "audio_id": {"type": "string"}
      },
      "additionalProperties": false,
      "required": ["text", "audio_source"]
    }
  }
}
