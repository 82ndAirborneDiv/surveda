{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Ask JSON Schemas",

  "definitions": {
    "questionnaire": {
      "type": "object",
      "properties": {
        "steps": { "$ref": "#/definitions/steps" },
        "quota_completed_msg": { "oneOf": [{ "$ref": "#/definitions/prompt" }, {"type":"null"}] },
        "error_msg": { "oneOf": [{ "$ref": "#/definitions/prompt" }, {"type":"null"}] }
      },
      "required": ["steps"]
    },

    "steps": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/step"
      }
    },

    "step": {
      "oneOf": [
        { "$ref": "#/definitions/multiple-choice" },
        { "$ref": "#/definitions/numeric" },
        { "$ref": "#/definitions/explanation" },
        { "$ref": "#/definitions/language-selection" }
      ]
    },

    "multiple-choice": {
      "properties": {
        "id": {"type": "string"},
        "type": { "enum": ["multiple-choice"] },
        "title": {"type": "string"},
        "prompt": { "$ref": "#/definitions/prompt"},
        "choices": { "$ref": "#/definitions/choices" },
        "store": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["id", "type", "title", "prompt", "choices", "store"]
    },

    "numeric": {
      "properties": {
        "id": {"type": "string"},
        "type": { "enum": ["numeric"] },
        "title": {"type": "string"},
        "prompt": { "$ref": "#/definitions/prompt"},
        "min_value": {"type": ["integer", "null"]},
        "max_value": {"type": ["integer", "null"]},
        "ranges_delimiters": {"type": ["string", "null"]},
        "ranges": {"$ref": "#/definitions/ranges"},
        "store": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["id", "type", "title", "prompt", "store"]
    },

    "explanation": {
      "properties": {
        "id": {"type": "string"},
        "type": { "enum": ["explanation"] },
        "title": {"type": "string"},
        "prompt": { "$ref": "#/definitions/prompt"},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false,
      "required": ["id", "type", "title", "prompt", "skip_logic"]
    },

    "language-selection": {
      "properties": {
        "id": {"type": "string"},
        "type": { "enum": ["language-selection"] },
        "title": {"type": "string"},
        "prompt": { "$ref": "#/definitions/lang_prompt"},
        "language_choices": { "type": "array" },
        "store": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["id", "type", "title", "prompt", "language_choices", "store"]
    },

    "choices": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/choice"
      }
    },

    "choice": {
      "properties": {
        "value": {"type": "string"},
        "responses": {"$ref": "#/definitions/responses"},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false,
      "required": ["responses", "value", "skip_logic"]
    },

    "ranges": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/range"
      }
    },

    "range": {
      "properties": {
        "from": {"type": ["integer", "null"]},
        "to": {"type": ["integer", "null"]},
        "skip_logic": {"type": ["string", "null"]}
      },
      "additionalProperties": false
    },

    "responses": {
      "type": "object",
      "properties": {
        "sms": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "ivr": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "prompt": {
      "type": "object",
      "additionalProperties": {"$ref": "#/definitions/lang_prompt"}
    },

    "lang_prompt": {
      "type": "object",
      "properties": {
        "sms": {"type": "string" },
        "ivr": {"$ref": "#/definitions/ivr_prompt"}
      },
      "additionalProperties": false
    },

    "ivr_prompt": {
      "type": "object",
      "properties": {
        "text": {"type": "string"},
        "audio_source": {"enum": ["tts", "upload"]},
        "audio_id": {"type": "string"}
      },
      "additionalProperties": false,
      "required": ["text", "audio_source"]
    }
  }
}
